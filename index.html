<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebView Advanced Security Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f9f9f9; }
    textarea, input, button { width: 100%; padding: 0.5rem; margin: 0.3rem 0; font-size: 1rem; box-sizing: border-box; }
    .log { background: #222; color: #0f0; padding: 1rem; font-family: monospace; white-space: pre-wrap; height: 250px; overflow-y: auto; border-radius: 6px; }
    h2 { margin-top: 1.8rem; }
    button { cursor: pointer; }
    #reloadBtn {
      width: auto;
      padding: 0.4rem 1rem;
      font-weight: bold;
      font-size: 1rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      margin-bottom: 1rem;
    }
    #reloadBtn:hover {
      background-color: #0056b3;
    }
    .test-section {
      background: white;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    .status { font-weight: bold; }
    .success { color: #28a745; }
    .warning { color: #ffc107; }
    .error { color: #dc3545; }
  </style>
</head>
<body>

  <button id="reloadBtn">ğŸ”„ Ricarica pagina</button>

  <h1>ğŸ” WebView Advanced Security Test</h1>

  <div class="test-section">
    <h2>ğŸ§  Informazioni Ambiente</h2>
    <p><strong>User-Agent:</strong> <span id="ua"></span></p>
    <p><strong>Cookie:</strong> <span id="cookie"></span></p>
    <p><strong>Referrer:</strong> <span id="referrer"></span></p>
    <p><strong>Origin:</strong> <span id="origin"></span></p>
    <p><strong>Protocol:</strong> <span id="protocol"></span></p>
  </div>

  <div class="test-section">
    <h2>ğŸ›  JavaScript Bridge Detection</h2>
    <ul>
      <li id="bridge-android">window.Android: <em>checking...</em></li>
      <li id="bridge-cordova">window.cordova: <em>checking...</em></li>
      <li id="bridge-capacitor">window.Capacitor: <em>checking...</em></li>
      <li id="bridge-plugins">window.plugins: <em>checking...</em></li>
      <li id="bridge-webkit">window.webkit: <em>checking...</em></li>
      <li id="bridge-external">window.external: <em>checking...</em></li>
    </ul>
  </div>

  <div class="test-section">
    <h2>âŒ¨ï¸ Input Monitoring Test</h2>
    <input type="text" placeholder="Test campo testo normale" id="textInput" />
    <input type="password" placeholder="Test campo password" id="passwordInput" />
    <input type="email" placeholder="test@example.com" id="emailInput" />
    <input type="tel" placeholder="+39 123 456 7890" id="phoneInput" />
    <textarea placeholder="Test textarea per testo lungo" id="textareaInput"></textarea>
  </div>

  <div class="test-section">
    <h2>ğŸŒ Network & CORS Test</h2>
    <div id="cors-result">Testing fetch to https://httpbin.org/get...</div>
    <button id="testXHR">Test XMLHttpRequest</button>
    <button id="testWebSocket">Test WebSocket</button>
    <div id="network-results"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ“± Device API Tests</h2>
    <button id="btnGetPosition">ğŸŒ Test Geolocation</button>
    <button id="btnTestCamera">ğŸ“· Test Camera Access</button>
    <button id="btnTestMicrophone">ğŸ¤ Test Microphone</button>
    <button id="btnTestNotification">ğŸ”” Test Notifications</button>
    <button id="btnTestVibration">ğŸ“³ Test Vibration</button>
    <div id="device-results"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ—„ï¸ Storage Tests</h2>
    <button id="btnTestLocalStorage">Test LocalStorage</button>
    <button id="btnTestSessionStorage">Test SessionStorage</button>
    <button id="btnTestIndexedDB">Test IndexedDB</button>
    <button id="btnTestWebSQL">Test WebSQL</button>
    <div id="storage-results"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ”’ Security Tests</h2>
    <button id="btnTestCSP">Test Content Security Policy</button>
    <button id="btnTestEval">Test eval() execution</button>
    <button id="btnTestInlineScript">Test inline script injection</button>
    <button id="btnTestFrameOptions">Test iframe loading</button>
    <div id="security-results"></div>
  </div>

  <div class="test-section">
    <h2>âš ï¸ Native Bridge Exploitation Tests</h2>
    <p><strong>âš ï¸ ATTENZIONE:</strong> Questi test tentano di chiamare funzioni native potenzialmente pericolose!</p>
    <button id="btnExploreExternal">ğŸ” Esplora window.external</button>
    <button id="btnTestCommonMethods">ğŸ“± Test metodi comuni Android</button>
    <button id="btnTestFileAccess">ğŸ“‚ Test accesso file system</button>
    <button id="btnTestAppInfo">â„¹ï¸ Test informazioni app</button>
    <button id="btnTestIntents">ğŸš€ Test Android Intents</button>
    <button id="btnFuzzing">ğŸ¯ Fuzzing automatico</button>
    <div id="native-results"></div>
  </div>

  <div class="test-section">
    <h2>ğŸ“œ Console Log</h2>
    <div class="log" id="log">Log in esecuzione...</div>
  </div>

  <script>
    const logElem = document.getElementById('log');
    function log(...args) {
      const timestamp = new Date().toLocaleTimeString();
      const out = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
      logElem.textContent += `\n[${timestamp}] ${out}`;
      logElem.scrollTop = logElem.scrollHeight;
      console.log(...args);
    }

    // Pulsante ricarica pagina
    document.getElementById('reloadBtn').addEventListener('click', () => {
      location.reload();
    });

    // Informazioni ambiente
    document.getElementById('ua').textContent = navigator.userAgent;
    document.getElementById('cookie').textContent = document.cookie || "(nessuno)";
    document.getElementById('referrer').textContent = document.referrer || "(nessuno)";
    document.getElementById('origin').textContent = window.location.origin;
    document.getElementById('protocol').textContent = window.location.protocol;

    // Bridge detection
    const bridges = [
      { name: 'Android', obj: 'window.Android', id: 'bridge-android' },
      { name: 'cordova', obj: 'window.cordova', id: 'bridge-cordova' },
      { name: 'Capacitor', obj: 'window.Capacitor', id: 'bridge-capacitor' },
      { name: 'plugins', obj: 'window.plugins', id: 'bridge-plugins' },
      { name: 'webkit', obj: 'window.webkit', id: 'bridge-webkit' },
      { name: 'external', obj: 'window.external', id: 'bridge-external' }
    ];

    bridges.forEach(bridge => {
      const obj = eval(bridge.obj);
      const elem = document.getElementById(bridge.id);
      if (obj) {
        elem.innerHTML = `${bridge.obj}: <span class="status success">âœ… presente</span>`;
        log(`${bridge.obj} rilevato:`, obj);
        // Prova a chiamare metodi se esistono
        try {
          if (typeof obj === 'object' && obj.constructor) {
            log(`${bridge.obj} constructor:`, obj.constructor.name);
          }
        } catch (e) {
          log(`Errore nell'analisi di ${bridge.obj}:`, e);
        }
      } else {
        elem.innerHTML = `${bridge.obj}: <span class="status error">âŒ assente</span>`;
      }
    });

    // Input monitoring
    ['textInput', 'passwordInput', 'emailInput', 'phoneInput', 'textareaInput'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', (e) => {
        log(`Input digitato (${e.target.type || 'textarea'}):`, e.target.value);
      });
      el.addEventListener('focus', (e) => {
        log(`Focus su campo:`, e.target.id);
      });
      el.addEventListener('blur', (e) => {
        log(`Blur da campo:`, e.target.id);
      });
    });

    // Network tests
    fetch("https://httpbin.org/get", { 
      method: "GET",
      headers: { 'Accept': 'application/json' }
    })
      .then(r => r.json())
      .then(data => {
        document.getElementById('cors-result').innerHTML = `<span class="status success">âœ… Fetch successful</span>`;
        log('Fetch response:', data);
      })
      .catch(e => {
        document.getElementById('cors-result').innerHTML = `<span class="status error">âŒ Fetch error: ${e.message}</span>`;
        log('Fetch error:', e);
      });

    // XMLHttpRequest test
    document.getElementById('testXHR').addEventListener('click', () => {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://httpbin.org/user-agent');
      xhr.onload = () => {
        log('XHR response:', xhr.responseText);
        document.getElementById('network-results').innerHTML += '<div>XHR: âœ… Success</div>';
      };
      xhr.onerror = (e) => {
        log('XHR error:', e);
        document.getElementById('network-results').innerHTML += '<div>XHR: âŒ Error</div>';
      };
      xhr.send();
    });

    // WebSocket test
    document.getElementById('testWebSocket').addEventListener('click', () => {
      try {
        const ws = new WebSocket('wss://echo.websocket.org/');
        ws.onopen = () => {
          log('WebSocket opened');
          ws.send('Test message');
          document.getElementById('network-results').innerHTML += '<div>WebSocket: âœ… Connected</div>';
        };
        ws.onmessage = (e) => {
          log('WebSocket message:', e.data);
          ws.close();
        };
        ws.onerror = (e) => {
          log('WebSocket error:', e);
          document.getElementById('network-results').innerHTML += '<div>WebSocket: âŒ Error</div>';
        };
      } catch (e) {
        log('WebSocket creation error:', e);
        document.getElementById('network-results').innerHTML += '<div>WebSocket: âŒ Creation Error</div>';
      }
    });

    // Geolocation test
    document.getElementById('btnGetPosition').addEventListener('click', () => {
      if (!navigator.geolocation) {
        log("âŒ navigator.geolocation non disponibile");
        return;
      }
      navigator.geolocation.getCurrentPosition(
        pos => {
          log("ğŸ“ Posizione ottenuta:", pos.coords);
          document.getElementById('device-results').innerHTML += '<div>Geolocation: âœ… Granted</div>';
        },
        err => {
          log("âŒ Errore posizione:", err);
          document.getElementById('device-results').innerHTML += '<div>Geolocation: âŒ Denied</div>';
        }
      );
    });

    // Camera test
    document.getElementById('btnTestCamera').addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        log('ğŸ“· Camera access granted');
        document.getElementById('device-results').innerHTML += '<div>Camera: âœ… Granted</div>';
        stream.getTracks().forEach(track => track.stop()); // Stop stream
      } catch (e) {
        log('âŒ Camera access denied:', e);
        document.getElementById('device-results').innerHTML += '<div>Camera: âŒ Denied</div>';
      }
    });

    // Microphone test
    document.getElementById('btnTestMicrophone').addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        log('ğŸ¤ Microphone access granted');
        document.getElementById('device-results').innerHTML += '<div>Microphone: âœ… Granted</div>';
        stream.getTracks().forEach(track => track.stop()); // Stop stream
      } catch (e) {
        log('âŒ Microphone access denied:', e);
        document.getElementById('device-results').innerHTML += '<div>Microphone: âŒ Denied</div>';
      }
    });

    // Notification test
    document.getElementById('btnTestNotification').addEventListener('click', async () => {
      if (!('Notification' in window)) {
        log('âŒ Notifications not supported');
        return;
      }
      
      const permission = await Notification.requestPermission();
      log('ğŸ”” Notification permission:', permission);
      document.getElementById('device-results').innerHTML += `<div>Notifications: ${permission === 'granted' ? 'âœ…' : 'âŒ'} ${permission}</div>`;
    });

    // Vibration test
    document.getElementById('btnTestVibration').addEventListener('click', () => {
      if ('vibrate' in navigator) {
        navigator.vibrate(200);
        log('ğŸ“³ Vibration triggered');
        document.getElementById('device-results').innerHTML += '<div>Vibration: âœ… Available</div>';
      } else {
        log('âŒ Vibration not supported');
        document.getElementById('device-results').innerHTML += '<div>Vibration: âŒ Not supported</div>';
      }
    });

    // Storage tests
    document.getElementById('btnTestLocalStorage').addEventListener('click', () => {
      try {
        localStorage.setItem('test', 'value');
        const value = localStorage.getItem('test');
        localStorage.removeItem('test');
        log('ğŸ—„ï¸ LocalStorage working:', value);
        document.getElementById('storage-results').innerHTML += '<div>LocalStorage: âœ… Available</div>';
      } catch (e) {
        log('âŒ LocalStorage error:', e);
        document.getElementById('storage-results').innerHTML += '<div>LocalStorage: âŒ Error</div>';
      }
    });

    document.getElementById('btnTestSessionStorage').addEventListener('click', () => {
      try {
        sessionStorage.setItem('test', 'value');
        const value = sessionStorage.getItem('test');
        sessionStorage.removeItem('test');
        log('ğŸ—„ï¸ SessionStorage working:', value);
        document.getElementById('storage-results').innerHTML += '<div>SessionStorage: âœ… Available</div>';
      } catch (e) {
        log('âŒ SessionStorage error:', e);
        document.getElementById('storage-results').innerHTML += '<div>SessionStorage: âŒ Error</div>';
      }
    });

    document.getElementById('btnTestIndexedDB').addEventListener('click', () => {
      if ('indexedDB' in window) {
        try {
          const request = indexedDB.open('testDB', 1);
          request.onsuccess = () => {
            log('ğŸ—„ï¸ IndexedDB available');
            document.getElementById('storage-results').innerHTML += '<div>IndexedDB: âœ… Available</div>';
            request.result.close();
          };
          request.onerror = (e) => {
            log('âŒ IndexedDB error:', e);
            document.getElementById('storage-results').innerHTML += '<div>IndexedDB: âŒ Error</div>';
          };
        } catch (e) {
          log('âŒ IndexedDB exception:', e);
          document.getElementById('storage-results').innerHTML += '<div>IndexedDB: âŒ Exception</div>';
        }
      } else {
        log('âŒ IndexedDB not supported');
        document.getElementById('storage-results').innerHTML += '<div>IndexedDB: âŒ Not supported</div>';
      }
    });

    // Security tests
    document.getElementById('btnTestEval').addEventListener('click', () => {
      try {
        const result = eval('2 + 2');
        log('ğŸ”’ eval() result:', result);
        document.getElementById('security-results').innerHTML += '<div>eval(): âš ï¸ Allowed</div>';
      } catch (e) {
        log('ğŸ”’ eval() blocked:', e);
        document.getElementById('security-results').innerHTML += '<div>eval(): âœ… Blocked</div>';
      }
    });

    document.getElementById('btnTestInlineScript').addEventListener('click', () => {
      try {
        const script = document.createElement('script');
        script.textContent = 'console.log("Inline script executed")';
        document.head.appendChild(script);
        document.head.removeChild(script);
        log('ğŸ”’ Inline script injection succeeded');
        document.getElementById('security-results').innerHTML += '<div>Script Injection: âš ï¸ Allowed</div>';
      } catch (e) {
        log('ğŸ”’ Inline script injection blocked:', e);
        document.getElementById('security-results').innerHTML += '<div>Script Injection: âœ… Blocked</div>';
      }
    });

    document.getElementById('btnTestFrameOptions').addEventListener('click', () => {
      try {
        const iframe = document.createElement('iframe');
        iframe.src = 'https://example.com';
        iframe.style.display = 'none';
        document.body.appendChild(iframe);
        
        setTimeout(() => {
          try {
            document.body.removeChild(iframe);
            log('ğŸ”’ Iframe loading allowed');
            document.getElementById('security-results').innerHTML += '<div>Iframe Loading: âš ï¸ Allowed</div>';
          } catch (e) {
            log('ğŸ”’ Iframe loading blocked:', e);
            document.getElementById('security-results').innerHTML += '<div>Iframe Loading: âœ… Blocked</div>';
          }
        }, 1000);
      } catch (e) {
        log('ğŸ”’ Iframe creation blocked:', e);
        document.getElementById('security-results').innerHTML += '<div>Iframe Loading: âœ… Blocked</div>';
      }
    });

    // Log errori JS in pagina
    window.onerror = (msg, src, line, col, err) => {
      log('â€¼ï¸ Errore JS:', msg, `at ${src}:${line}:${col}`, err);
    };

    // Log unhandled promise rejections
    window.addEventListener('unhandledrejection', (e) => {
      log('â€¼ï¸ Unhandled Promise Rejection:', e.reason);
    });

    // Native Bridge Exploitation Tests
    document.getElementById('btnExploreExternal').addEventListener('click', () => {
      log('ğŸ” === EXPLORING window.external ===');
      
      if (window.external) {
        // Esplora tutte le proprietÃ  e metodi
        try {
          const props = Object.getOwnPropertyNames(window.external);
          log('ğŸ“‹ window.external properties:', props);
          
          props.forEach(prop => {
            try {
              const value = window.external[prop];
              const type = typeof value;
              log(`  - ${prop}: ${type}`, type === 'function' ? '[FUNCTION]' : value);
              
              if (type === 'function') {
                // Prova a chiamare con parametri comuni
                try {
                  // Test con parametri vuoti
                  const result1 = window.external[prop]();
                  log(`    â””â”€ ${prop}() result:`, result1);
                } catch (e) {
                  log(`    â””â”€ ${prop}() error:`, e.message);
                }
              }
            } catch (e) {
              log(`  - ${prop}: [ACCESS_DENIED]`, e.message);
            }
          });
          
          document.getElementById('native-results').innerHTML += '<div>window.external: âœ… Explored</div>';
        } catch (e) {
          log('âŒ Error exploring window.external:', e);
          document.getElementById('native-results').innerHTML += '<div>window.external: âŒ Error</div>';
        }
      } else {
        log('âŒ window.external not available');
        document.getElementById('native-results').innerHTML += '<div>window.external: âŒ Not available</div>';
      }
    });

    document.getElementById('btnTestCommonMethods').addEventListener('click', () => {
      log('ğŸ“± === TESTING COMMON ANDROID METHODS ===');
      
      const commonMethods = [
        // Metodi Android comuni
        'showToast', 'toast', 'alert', 'notify',
        'openApp', 'launchApp', 'startActivity',
        'getDeviceInfo', 'getAppVersion', 'getBuildInfo',
        'readContacts', 'getContacts', 'accessContacts',
        'makeCall', 'sendSMS', 'dial',
        'takePicture', 'openCamera', 'capturePhoto',
        'getLocation', 'getCurrentLocation', 'gps',
        'writeFile', 'readFile', 'saveFile',
        'openSettings', 'goToSettings',
        'minimize', 'close', 'exit', 'finish',
        'shareContent', 'share',
        'openBrowser', 'openURL',
        'getClipboard', 'setClipboard'
      ];

      // Testa su tutti i possibili bridge
      const bridges = ['window.external', 'window.Android', 'window.webkit', 'window.cordova'];
      
      bridges.forEach(bridgeName => {
        const bridge = eval(bridgeName);
        if (bridge) {
          log(`ğŸŒ‰ Testing bridge: ${bridgeName}`);
          
          commonMethods.forEach(method => {
            try {
              if (typeof bridge[method] === 'function') {
                log(`  ğŸ“ Found method: ${bridgeName}.${method}`);
                
                // Prova chiamate con parametri diversi
                try {
                  bridge[method]();
                  log(`    âœ… ${method}() - Success (no params)`);
                } catch (e) {
                  log(`    âŒ ${method}() - Error:`, e.message);
                }
                
                try {
                  bridge[method]('test');
                  log(`    âœ… ${method}('test') - Success`);
                } catch (e) {
                  log(`    âŒ ${method}('test') - Error:`, e.message);
                }
              }
            } catch (e) {
              // Silently continue
            }
          });
        }
      });
      
      document.getElementById('native-results').innerHTML += '<div>Common Methods: âœ… Tested</div>';
    });

    document.getElementById('btnTestFileAccess').addEventListener('click', () => {
      log('ğŸ“‚ === TESTING FILE SYSTEM ACCESS ===');
      
      const filePaths = [
        '/sdcard/',
        '/storage/emulated/0/',
        '/data/data/',
        '/system/build.prop',
        '/proc/version',
        '/etc/hosts',
        'file:///android_asset/',
        'content://settings/secure/'
      ];

      // Test fetch con file: protocol
      filePaths.forEach(path => {
        fetch(`file://${path}`)
          .then(response => {
            log(`ğŸ“ File access to ${path}:`, response.status);
            if (response.ok) {
              return response.text();
            }
          })
          .then(text => {
            if (text) {
              log(`ğŸ“„ Content of ${path}:`, text.substring(0, 200));
            }
          })
          .catch(e => {
            log(`âŒ File access to ${path} failed:`, e.message);
          });
      });

      // Test con XMLHttpRequest
      const xhr = new XMLHttpRequest();
      xhr.open('GET', 'file:///system/build.prop', true);
      xhr.onload = () => {
        log('ğŸ“ XHR file access result:', xhr.responseText.substring(0, 200));
      };
      xhr.onerror = (e) => {
        log('âŒ XHR file access failed:', e);
      };
      try {
        xhr.send();
      } catch (e) {
        log('âŒ XHR file access exception:', e);
      }
      
      document.getElementById('native-results').innerHTML += '<div>File Access: âœ… Tested</div>';
    });

    document.getElementById('btnTestAppInfo').addEventListener('click', () => {
      log('â„¹ï¸ === TESTING APP INFORMATION LEAKS ===');
      
      // Test proprietÃ  disponibili
      const infoSources = [
        'navigator',
        'window.external',
        'window.Android',
        'screen',
        'history',
        'location'
      ];

      infoSources.forEach(sourceName => {
        const source = eval(sourceName);
        if (source) {
          log(`ğŸ“Š Exploring ${sourceName}:`);
          
          try {
            const props = Object.getOwnPropertyNames(source);
            props.forEach(prop => {
              try {
                const value = source[prop];
                if (typeof value !== 'function' && value !== null && value !== undefined) {
                  log(`  - ${sourceName}.${prop}:`, value);
                }
              } catch (e) {
                // Skip restricted properties
              }
            });
          } catch (e) {
            log(`  âŒ Cannot explore ${sourceName}:`, e.message);
          }
        }
      });

      // Test URL parameters
      log('ğŸ”— URL Parameters:', window.location.search);
      log('ğŸ”— URL Hash:', window.location.hash);
      log('ğŸ”— Full URL:', window.location.href);
      
      document.getElementById('native-results').innerHTML += '<div>App Info: âœ… Collected</div>';
    });

    document.getElementById('btnTestIntents').addEventListener('click', () => {
      log('ğŸš€ === TESTING ANDROID INTENTS ===');
      
      const intentSchemes = [
        'tel:+1234567890',
        'sms:+1234567890',
        'mailto:test@example.com',
        'geo:0,0?q=latitude,longitude',
        'market://details?id=com.example.app',
        'content://contacts/people/',
        'http://malicious-site.com',
        'file:///sdcard/',
        'intent://example.com#Intent;scheme=http;package=com.android.browser;end'
      ];

      intentSchemes.forEach(intent => {
        try {
          // Testa con window.open
          log(`ğŸ”— Testing intent: ${intent}`);
          
          // Crea link nascosto e prova a cliccare
          const link = document.createElement('a');
          link.href = intent;
          link.target = '_blank';
          link.style.display = 'none';
          document.body.appendChild(link);
          
          setTimeout(() => {
            try {
              link.click();
              log(`  âœ… Intent ${intent} - Click attempted`);
            } catch (e) {
              log(`  âŒ Intent ${intent} - Error:`, e.message);
            } finally {
              document.body.removeChild(link);
            }
          }, 100);
          
        } catch (e) {
          log(`âŒ Intent ${intent} failed:`, e.message);
        }
      });
      
      document.getElementById('native-results').innerHTML += '<div>Android Intents: âœ… Tested</div>';
    });

    document.getElementById('btnFuzzing').addEventListener('click', () => {
      log('ğŸ¯ === AUTOMATED FUZZING ===');
      
      const payloads = [
        '', 'null', 'undefined', '0', '1', '-1', 'true', 'false',
        'test', '../../../etc/passwd', '<script>alert(1)<\/script>',
        'javascript:alert(1)', 'file:///etc/passwd',
        '{"test": "value"}', '[1,2,3]', 'function(){return 1;}',
        '%00', '%2e%2e%2f', String.fromCharCode(0), String.fromCharCode(10, 13, 9)
      ];

      if (window.external) {
        const methods = Object.getOwnPropertyNames(window.external)
          .filter(prop => typeof window.external[prop] === 'function');
        
        log(`ğŸ¯ Found ${methods.length} methods to fuzz`);
        
        methods.forEach(method => {
          payloads.forEach(payload => {
            try {
              const result = window.external[method](payload);
              if (result !== undefined) {
                log(`ğŸ¯ window.external.${method}('${payload}') = ${result}`);
              }
            } catch (e) {
              // Log only interesting errors
              if (!e.message.includes('Not enough arguments')) {
                log(`ğŸ¯ window.external.${method}('${payload}') error: ${e.message}`);
              }
            }
          });
        });
      }
      
      document.getElementById('native-results').innerHTML += '<div>Fuzzing: âœ… Completed</div>';
    });

    log('ğŸš€ WebView Security Test initialized');
  </script>

</body>
</html>
