<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WebView Advanced Security Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f9f9f9; }
    textarea, input, button { width: 100%; padding: 0.5rem; margin: 0.3rem 0; font-size: 1rem; box-sizing: border-box; }
    .log { background: #222; color: #0f0; padding: 1rem; font-family: monospace; white-space: pre-wrap; height: 250px; overflow-y: auto; border-radius: 6px; }
    h2 { margin-top: 1.8rem; }
    button { cursor: pointer; }
    #reloadBtn {
      width: auto;
      padding: 0.4rem 1rem;
      font-weight: bold;
      font-size: 1rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      margin-bottom: 1rem;
    }
    #reloadBtn:hover {
      background-color: #0056b3;
    }
    .test-section {
      background: white;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    .status { font-weight: bold; }
    .success { color: #28a745; }
    .warning { color: #ffc107; }
    .error { color: #dc3545; }
    .exploit-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem;
      margin: 0.2rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .exploit-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>

  <button id="reloadBtn">üîÑ Ricarica pagina</button>

  <h1>üîç WebView Advanced Security Test</h1>

  <div class="test-section">
    <h2>üß† Informazioni Ambiente</h2>
    <p><strong>User-Agent:</strong> <span id="ua"></span></p>
    <p><strong>Cookie:</strong> <span id="cookie"></span></p>
  </div>

  <div class="test-section">
    <h2>üõ† JavaScript Bridge Detection</h2>
    <ul>
      <li id="bridge-external">window.external: <em>checking...</em></li>
      <li id="bridge-android">window.Android: <em>checking...</em></li>
      <li id="bridge-webkit">window.webkit: <em>checking...</em></li>
    </ul>
  </div>

  <div class="test-section">
    <h2>‚å®Ô∏è Input Test</h2>
    <input type="text" placeholder="Test campo testo" id="textInput" />
    <input type="password" placeholder="Test campo password" id="passwordInput" />
  </div>

  <div class="test-section">
    <h2>üîí Security Tests</h2>
    <button id="btnTestEval">Test eval() execution</button>
    <button id="btnTestScript">Test script injection</button>
    <button id="btnTestStorage">Test storage</button>
    <div id="security-results"></div>
  </div>

  <div class="test-section">
    <h2>üíÄ Exploit Tests</h2>
    <button class="exploit-btn" id="btnExploitEval">üí£ Test eval()</button>
    <button class="exploit-btn" id="btnExploitScript">üß¨ Test Script Injection</button>
    <button class="exploit-btn" id="btnExploitStorage">üíæ Nascondi dati malevoli</button>
    <button class="exploit-btn" id="btnCheckStorage">üîç Verifica dati nascosti</button>
    <button class="exploit-btn" id="btnExploitKeylogger">‚å®Ô∏è Test Keylogger</button>
    <div id="exploit-results"></div>
  </div>

  <div class="test-section">
    <h2>üìú Console Log</h2>
    <div class="log" id="log">Log inizializzato...</div>
  </div>

  <script>
    var logElem = document.getElementById('log');
    
    function log() {
      var args = Array.prototype.slice.call(arguments);
      var timestamp = new Date().toLocaleTimeString();
      var out = args.map(function(a) {
        return typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a);
      }).join(' ');
      logElem.textContent += '\n[' + timestamp + '] ' + out;
      logElem.scrollTop = logElem.scrollHeight;
      console.log.apply(console, arguments);
    }

    // Reload button
    document.getElementById('reloadBtn').addEventListener('click', function() {
      location.reload();
    });

    // Environment info
    document.getElementById('ua').textContent = navigator.userAgent;
    document.getElementById('cookie').textContent = document.cookie || "(nessuno)";

    // Bridge detection
    function checkBridge(objName, elementId) {
      var obj = window[objName.split('.')[1]];
      var elem = document.getElementById(elementId);
      if (obj) {
        elem.innerHTML = 'window.' + objName.split('.')[1] + ': <span class="status success">‚úÖ presente</span>';
        log('Bridge rilevato:', objName, obj);
      } else {
        elem.innerHTML = 'window.' + objName.split('.')[1] + ': <span class="status error">‚ùå assente</span>';
      }
    }

    checkBridge('window.external', 'bridge-external');
    checkBridge('window.Android', 'bridge-android'); 
    checkBridge('window.webkit', 'bridge-webkit');

    // Input monitoring
    document.getElementById('textInput').addEventListener('input', function(e) {
      log('Input testo:', e.target.value);
    });
    
    document.getElementById('passwordInput').addEventListener('input', function(e) {
      log('Input password:', e.target.value);
    });

    // Security tests
    document.getElementById('btnTestEval').addEventListener('click', function() {
      try {
        var result = eval('2 + 2');
        log('eval() result:', result);
        document.getElementById('security-results').innerHTML += '<div>eval(): ‚ö†Ô∏è Consentito</div>';
      } catch (e) {
        log('eval() bloccato:', e);
        document.getElementById('security-results').innerHTML += '<div>eval(): ‚úÖ Bloccato</div>';
      }
    });

    document.getElementById('btnTestScript').addEventListener('click', function() {
      try {
        var script = document.createElement('script');
        script.textContent = 'console.log("Script iniettato");';
        document.head.appendChild(script);
        document.head.removeChild(script);
        log('Script injection riuscita');
        document.getElementById('security-results').innerHTML += '<div>Script Injection: ‚ö†Ô∏è Consentito</div>';
      } catch (e) {
        log('Script injection bloccata:', e);
        document.getElementById('security-results').innerHTML += '<div>Script Injection: ‚úÖ Bloccato</div>';
      }
    });

    document.getElementById('btnTestStorage').addEventListener('click', function() {
      try {
        localStorage.setItem('test', 'valore');
        var value = localStorage.getItem('test');
        localStorage.removeItem('test');
        log('Storage funzionante:', value);
        document.getElementById('security-results').innerHTML += '<div>Storage: ‚úÖ Disponibile</div>';
      } catch (e) {
        log('Storage error:', e);
        document.getElementById('security-results').innerHTML += '<div>Storage: ‚ùå Errore</div>';
      }
    });

    // Exploit tests
    document.getElementById('btnExploitEval').addEventListener('click', function() {
      log('üí£ EXPLOIT: eval() test');
      try {
        var result = eval('alert("Exploit eval riuscito!"); 5');
        log('Exploit eval risultato:', result);
        document.getElementById('exploit-results').innerHTML += '<div style="color: red;">üí£ eval(): ‚úÖ EXPLOIT RIUSCITO</div>';
      } catch (e) {
        log('Exploit eval bloccato:', e);
        document.getElementById('exploit-results').innerHTML += '<div style="color: green;">üí£ eval(): ‚ùå Bloccato</div>';
      }
    });

    document.getElementById('btnExploitScript').addEventListener('click', function() {
      log('üß¨ EXPLOIT: Script injection test');
      try {
        var script = document.createElement('script');
        script.textContent = 'alert("Script exploit riuscito!");';
        document.head.appendChild(script);
        log('Script exploit eseguito');
        document.getElementById('exploit-results').innerHTML += '<div style="color: red;">üß¨ Script: ‚úÖ EXPLOIT RIUSCITO</div>';
        setTimeout(function() {
          document.head.removeChild(script);
        }, 1000);
      } catch (e) {
        log('Script exploit bloccato:', e);
        document.getElementById('exploit-results').innerHTML += '<div style="color: green;">üß¨ Script: ‚ùå Bloccato</div>';
      }
    });

    document.getElementById('btnExploitStorage').addEventListener('click', function() {
      log('üíæ EXPLOIT: Nascondendo dati malevoli...');
      try {
        var maliciousData = {
          type: 'exploit_data',
          timestamp: new Date().toISOString(),
          payload: 'codice_malevolo_nascosto',
          attacker_id: 'hacker_001',
          target: 'user_data'
        };
        localStorage.setItem('exploit_test', JSON.stringify(maliciousData));
        localStorage.setItem('malicious_payload', 'eval("alert(\'Sono ancora qui!\')")');
        
        var stored = localStorage.getItem('exploit_test');
        log('üíæ Dati malevoli nascosti con successo:', JSON.parse(stored));
        document.getElementById('exploit-results').innerHTML += '<div style="color: red;">üíæ Storage: ‚úÖ DATI MALEVOLI NASCOSTI</div>';
        alert('Dati malevoli nascosti! Usa il pulsante "Verifica" per controllare se sono ancora l√¨.');
      } catch (e) {
        log('Storage exploit bloccato:', e);
        document.getElementById('exploit-results').innerHTML += '<div style="color: green;">üíæ Storage: ‚ùå Bloccato</div>';
      }
    });

    document.getElementById('btnCheckStorage').addEventListener('click', function() {
      log('üîç VERIFICA: Controllando se i dati malevoli sono ancora presenti...');
      try {
        var exploitData = localStorage.getItem('exploit_test');
        var maliciousPayload = localStorage.getItem('malicious_payload');
        
        if (exploitData) {
          log('üö® TROVATI dati malevoli persistenti:', JSON.parse(exploitData));
          document.getElementById('exploit-results').innerHTML += '<div style="color: red;">üîç Verifica: ‚ö†Ô∏è DATI MALEVOLI ANCORA PRESENTI!</div>';
          alert('ATTENZIONE: I dati malevoli sono ancora qui! Anche dopo aver ricaricato la pagina.');
        } else {
          log('‚úÖ Nessun dato malevolo trovato');
          document.getElementById('exploit-results').innerHTML += '<div style="color: green;">üîç Verifica: ‚úÖ Nessun dato trovato</div>';
          alert('Nessun dato malevolo trovato nello storage.');
        }
        
        if (maliciousPayload) {
          log('üí£ TROVATO payload malevolo:', maliciousPayload);
          alert('TROVATO anche un payload malevolo che potrebbe essere eseguito!');
        }
        
      } catch (e) {
        log('Errore nella verifica:', e);
      }
    });

    document.getElementById('btnExploitKeylogger').addEventListener('click', function() {
      log('‚å®Ô∏è EXPLOIT: Keylogger test');
      try {
        var isActive = true;
        var keylogger = function(e) {
          if (isActive) {
            log('Tasto intercettato:', e.target.type, e.target.value);
          }
        };
        
        var inputs = document.querySelectorAll('input');
        for (var i = 0; i < inputs.length; i++) {
          inputs[i].addEventListener('input', keylogger);
        }
        
        log('Keylogger attivato per 10 secondi');
        document.getElementById('exploit-results').innerHTML += '<div style="color: red;">‚å®Ô∏è Keylogger: ‚úÖ ATTIVO (10 sec)</div>';
        
        setTimeout(function() {
          isActive = false;
          log('Keylogger disattivato');
        }, 10000);
        
      } catch (e) {
        log('Keylogger bloccato:', e);
        document.getElementById('exploit-results').innerHTML += '<div style="color: green;">‚å®Ô∏è Keylogger: ‚ùå Bloccato</div>';
      }
    });

    // Error handling
    window.onerror = function(msg, src, line) {
      log('Errore JS:', msg, 'linea ' + line);
    };

    log('Test di sicurezza WebView inizializzato');
  </script>

</body>
</html>
